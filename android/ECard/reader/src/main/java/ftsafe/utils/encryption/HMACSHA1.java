package ftsafe.utils.encryption;

import javax.crypto.Mac;
import javax.crypto.SecretKey;
import javax.crypto.spec.SecretKeySpec;

import ftsafe.utils.BaseFunction;


public class HMACSHA1 {   
    private static final String MAC_NAME = "HmacSHA1";    
    private static final String ENCODING = "UTF-8";
    static BaseFunction ftPublic = new BaseFunction();
      
    /* 
     * 展示了一个生成指定算法密钥的过程 初始化HMAC密钥  
     * @return  
     * @throws Exception 
     *  
      public static String initMacKey() throws Exception { 
      //得到一个 指定算法密钥的密钥生成器 
      KeyGenerator KeyGenerator keyGenerator =KeyGenerator.getInstance(MAC_NAME);  
      //生成一个密钥 
      SecretKey secretKey =keyGenerator.generateKey(); 
      return null; 
      } 
     */  
      
    /**  
     * 使用 HMAC-SHA1 签名方法对对encryptText进行签名  
     * @param encryptText 被签名的字符串 (ACSII数据串) 
     * @param encryptKey  密钥 (ACSII数据串)  
     * @return  
     * @throws Exception  
     */    
    public static byte[] HmacSHA1Encrypt(String encryptText, String encryptKey) throws Exception     
    {           
        byte[] data=ftPublic.ftStringToByte(encryptKey);  
        //根据给定的字节数组构造一个密钥,第二参数指定一个密钥算法的名称  
        SecretKey secretKey = new SecretKeySpec(data, MAC_NAME);   
        //生成一个指定 Mac 算法 的 Mac 对象  
        Mac mac = Mac.getInstance(MAC_NAME);   
        //用给定密钥初始化 Mac 对象  
        mac.init(secretKey);    
          
        byte[] text = ftPublic.ftStringToByte(encryptText);    
        //完成 Mac 操作   
        return mac.doFinal(text);    
    }    
    
    public static void main(String[] args) throws Exception {  
        String pbServerCert = "308201FAA0030201020204534CE529300D06092A864886F70D0101050500303831133011060A0992268993F22C6401191603636F6D31123010060A0992268993F22C64011916026674310D300B0603550403130445534341301E170D3134303431353037353230395A170D3136303431343037353230395A305E315C300A060355040B13034355503013060355040A130C4346434120544553542043413017060355040B1310435550207375706572207365727665723020060355040313196269616E6D696E2D74657374406368696E617061792E636F6D30820122300D06092A864886F70D01010105000382010F003082010A0282010100B766FD657AFBBA65C923666F709E99176EC15BB4676527F8CF18BE99B02BBC678D7427A1D04A25856C1E90412DC803E01E9BDC4C606E1B369AC541DB1B6AE450377B28CFA3AAD36AD769646D12FEEDC7DF87CCEC163213E6A5AC2892CB3A8A2C586B552ACF7108EB9174B52064B3F0DAB961A86E43405C3276C9B400BC863C62FE1465C310E342F7F11C1E3440EFB9B9DF6E74D7EE22CDC4013547CB546AD81E0FC9F80A295D6140FE12D120D110A3F2BB1D7D732A3585106A89CC256227665E18939A8E869F6A95AA58CE95D50CECE2A57A1253DF185E5551B4CEE4DB59FA0DEB2DAC3DBFC44327432088F0A7367B5DD20B50B8B8C31F0B6096FE6819BD6C8F0203010001";  
        String pbTermCert = "308204FCA003020102020A4BBD388C000000029128300D06092A864886F70D0101050500303831133011060A0992268993F22C6401191603636F6D31123010060A0992268993F22C64011916026674310D300B0603550403130445534341301E170D3134303431353132323830345A170D3136303331303037343234365A306831133011060A0992268993F22C6401191603636F6D31123010060A0992268993F22C64011916026674310E300C060355040313055573657273310E300C060355040313057465737431311D301B06092A864886F70D010901160E74657374406D61696C2E7061676530820122300D06092A864886F70D01010105000382010F003082010A0282010100D6A44F2A183EF3BB4DB9D06B861927F47E513FBFB33271E414621D8A284B86EAFF7497D3FC792EEF99A702C857A35809197B76E07CED448E8488F9315BB9A54ED67EE8C99C7E964CA3BD1D96C98B7E3A20FC2261BF769E6A4392ACF499222C69F0CEC8C1E91749B07231237B59517FD1B95935517FDD4C3D1A3E72C824515E5CF0FE7E33A02E423775CFF285DA0A05959BBA397EE499F32F933046B339A8F659B927DAB928807A81E9E5BFA0910A268357F35D33FC3B05DFA1D8A914EA3E0CB9A967E774A134941F018FF837BC92474EB4822543520B198641CCAA255E7159AD9FBB08578ADE89E9AC1A88C19B61C9D49A8E96F857197233A833B3AA573FA8ED0203010001A38202EE308202EA300B0603551D0F0404030205A0304406092A864886F70D01090F04373035300E06082A864886F70D030202020100300E06082A864886F70D030402020100300706052B0E030207300A06082A864886F70D0307301D0603551D0E04160414A0F36E7832CC1F107D28E7C6CC4B8AD591C7423D303E06092B06010401823715070431302F06272B060104018237150881B5B63185A3D80986C1873C8796937686CD8819815782B9E80383D4BA66020164020106301F0603551D23041830168014FA3F596E5CE1B0C1C34A1C6BB1CEADE9C585C1583081C50603551D1F0481BD3081BA3081B7A081B4A081B18681AE6C6461703A2F2F2F434E3D455343412C434E3D57494E2D4E4442394B4C4D485235472C434E3D4344502C434E3D5075626C69632532304B657925323053657276696365732C434E3D53657276696365732C434E3D436F6E66696775726174696F6E2C44433D66742C44433D636F6D3F63657274696669636174655265766F636174696F6E4C6973743F626173653F6F626A656374436C6173733D63524C446973747269627574696F6E506F696E743081B106082B060105050701010481A43081A130819E06082B060105050730028681916C6461703A2F2F2F434E3D455343412C434E3D4149412C434E3D5075626C69632532304B657925323053657276696365732C434E3D53657276696365732C434E3D436F6E66696775726174696F6E2C44433D66742C44433D636F6D3F634143657274696669636174653F626173653F6F626A656374436C6173733D63657274696669636174696F6E417574686F7269747930290603551D250422302006082B0601050507030206082B06010505070304060A2B0601040182370A0304303506092B060104018237150A04283026300A06082B06010505070302300A06082B06010505070304300C060A2B0601040182370A030430370603551D110430302EA01C060A2B060104018237140203A00E0C0C74657374314066742E636F6D810E74657374406D61696C2E70616765"; 
        String R1 = "084C8B46211A7D9BDDFAEC6964C88D9CCAE29E8CCE958519A5D6B4FAFA33CF5232"; 
        String R2 = "11E0627CD0E51D81C3EA09852786A58548A7EE6C55E3D6345980B664C580ABA7EB"; 
        String pbSignature="61D1B85EF4093D1109AF5921EB17601D37050A1B01ADE7D5A30938DBE9EE3481338C19CAA2456249B81FCE6AC53CDBE1B0960D808F016ADFD865EF492FC53D29DC4B3202ADE1427CB4BFE534E84CA2A979232B92BA76E8D7DD3860B9BDC8CE94FB91599180F404FD8C2E11DB5FB01F2094832C94201AFC2D74A7AACA8D55FE668BBE2E97D681D16D8071E7E09B34F2C0C688D99C715C461B9D69AC006084817CBABA54604E345B0482B43C56EFA39E3F4D8F1923CE5610EB101159208E296C9A1E1893C7785FFBE68BF0DF19265DF9C52B94CD2478EE8185C3ECF6ADEB01BBDF5AD89DC28A557FA73D10292EBC684C9DCDDC05A58589E61C86774E4A1CD6CB80";
        String pbEncMasterKey = "1D3A79FD86C94DA77938592127AA621F381D4C0D3911B609ED9DDD44F18DE5D67E882B0E6253937C272BEC25341B4BB7366E79D9A3106ECE47DAFE1B13CAE06AC962052E8FD5E96BA187A08BB5D896A9492664E889B5065EEE7A497D9A24CA85FB1D135809E276537507C9E16DBE022041E8A98DAE700B6277D81CB8BBCAF1379BB0C4D1B8E125775D44B4F5272C61AD993313373D65324BB804BDC1A87F2C475150C8D5E3BD565BF8B74FDD7EB4B5343731B7D2BDE04C6A7B8E482F54251C19B40E52E0269714D43BEA59A700E89E6D96D5291A9EEF06CAE67FFEB5F285A3B5C53A2024124703A27908BCF5A21A049E8A5B1B7CD634363AE00EBA0D3B199026";
        String key = "555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555";
        
        String shaServerCert = new SHA1().doSHA1(ftPublic.ftStringToByte(pbServerCert));
        String shaTermCert = new SHA1().doSHA1(ftPublic.ftStringToByte(pbTermCert));
        
        String H4 = R2+R1+shaServerCert+shaTermCert+pbSignature+pbEncMasterKey;
        H4=ftPublic.ftBCDToASCII("SERVER")+ new SHA1().doSHA1(ftPublic.ftStringToByte(H4));
        
        //String buf = DoData.byteToString(getHmacSHA1(H4,key));
        String buf1 = ftPublic.ftByteToString(HmacSHA1Encrypt(H4,key));
        
        //String buf = DoData.byteToString(getHmacSHA1("A704F082B28CA20BB0CEBE7161253369E324AB93ABE5DAA8672011B70A8D905F966888198145DEB59B5141809D043CE7","A704F082B28CA20BB0CEBE7161253369E324AB93ABE5DAA8672011B70A8D905F966888198145DEB59B5141809D043CE7"));
        //String buf1 = DoData.byteToString(HmacSHA1Encrypt("A704F082B28CA20BB0CEBE7161253369E324AB93ABE5DAA8672011B70A8D905F966888198145DEB59B5141809D043CE7","A704F082B28CA20BB0CEBE7161253369E324AB93ABE5DAA8672011B70A8D905F966888198145DEB59B5141809D043CE7"));
        
        //System.out.println(buf);  
        System.out.println(buf1); 
    }

}
